
###############################
### Civil Wars by MrFunEGUY ###
###############################

namespace = civend

##################
#   Civil Wars   #
##################

# Initializer, normal Civil Wars
country_event = {
	id = civend.1000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				using_war_goal = {
					type = wg_civwar
					owner = root
				}
				using_war_goal = {
					type = wg_planet_heir_rebellion
					owner = root
				}
				using_war_goal = {
					type = wg_civwar_heir
					owner = root
				}
				using_war_goal = {
					type = wg_coup_successor_mother
					owner = root
				}
				using_war_goal = {
					type = wg_coup_independent
					owner = root
				}
				using_war_goal = {
					type = wg_coup_fealty
					owner = root
				}
				using_war_goal = {
					type = wg_admiral_rebellion
					owner = root
				}
			}
		}
	}

	immediate = {

		from = {
			ruler = {
				save_global_event_target_as = defeated_traitor
			}
		}

		clone_leader = {
			target = event_target:defeated_traitor
			class = ruler
			effect = {
				save_global_event_target_as = defeated_traitor
			}
		}

		if = {
			limit = {
				is_autocracy = yes
				any_country = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
					}
				}
			}
			random_list = {
				40 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						30 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						5 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					country_event = { id = civend.1001 }
				}
				45 = { # Flees
					random_list = {
						30 = { # Disappears
							country_event = { id = civend.1002 }
						}
						70 = { # Works for foreign empire
							country_event = { id = civend.1003 }
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					country_event = { id = civend.1004 }
				}
			}
		}
		else_if = {
			limit = {
				is_autocracy = yes
			}
			random_list = {
				40 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						30 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						5 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					country_event = { id = civend.1001 }
				}
				45 = { #Flees
					random_list = {
						100 = { # Disappears
							country_event = { id = civend.1002 }
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					country_event = { id = civend.1004 }
				}
			}
		}
		else_if = {
			limit = {
				any_country = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
					}
				}
			}
			random_list = {
				30 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						25 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						10 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					country_event = { id = civend.1001 }
				}
				55 = {
					random_list = {
						50 = { # Disappears
							country_event = { id = civend.1002 }
						}
						50 = { # Works for foreign empire
							country_event = { id = civend.1003 }
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					country_event = { id = civend.1004 }
				}
			}
		}
		else = {
			random_list = {
				30 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						25 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						10 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					country_event = { id = civend.1001 }
				}
				55 = {
					random_list = {
						100 = { # Disappears
							country_event = { id = civend.1002 }
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					country_event = { id = civend.1004 }
				}
			}
		}
	}
}

# Traitorous Leader is Dead
country_event = {
	id = civend.1001
	title = civend.1001.name
	picture = GFX_evt_surrender
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.1001.hanging.desc
		trigger = {
			has_country_flag = death_by_hanging
		}
	}

	desc = {
		text = civend.1001.jumping.desc
		trigger = {
			has_country_flag = death_by_jumping
		}
	}

	desc = {
		text = civend.1001.spacing.desc
		trigger = {
			has_country_flag = death_by_spacing
		}
	}

	desc = {
		text = civend.1001.gun.desc
		trigger = {
			has_country_flag = death_by_gun
		}
	}

	desc = {
		text = civend.1001.poison.desc
		trigger = {
			has_country_flag = death_by_poison
		}
	}

	desc = {
		text = civend.1001.coup.desc
		trigger = {
			has_country_flag = death_by_coup
		}
	}

	# Unfortunate we couldn't capture them
	option = {
		name = civend.1001.a
		hidden_effect = {
			event_target:defeated_traitor = {
				kill_leader = { show_notification = no }
			}
		}
	}

	after = {
		if = {
			limit = {
				has_country_flag = death_by_hanging
			}
			remove_country_flag = death_by_hanging
		}
		else_if = {
			limit = {
				has_country_flag = death_by_jumping
			}
			remove_country_flag = death_by_jumping
		}
		else_if = {
			limit = {
				has_country_flag = death_by_spacing
			}
			remove_country_flag = death_by_spacing
		}
		else_if = {
			limit = {
				has_country_flag = death_by_gun
			}
			remove_country_flag = death_by_gun
		}
		else_if = {
			limit = {
				has_country_flag = death_by_poison
			}
			remove_country_flag = death_by_poison
		}
		else_if = {
			limit = {
				has_country_flag = death_by_coup
			}
			remove_country_flag = death_by_coup
		}
	}
}

# Traitorous Leader Disappears, never to reappear.
country_event = {
	id = civend.1002
	title = civend.1002.name
	desc = civend.1002.desc
	picture = GFX_evt_surrender
	location = event_target:civwar_rebels
	hide_window = no
	is_triggered_only = yes

	# Coward
	option = {
		name = civend.1002.a
		hidden_effect = {
			event_target:defeated_traitor = {
				kill_leader = { show_notification = no }
			}
		}
	}
}

# Traitorous Leader Escapes is escaping to another empire, will works for them.
country_event = {
	id = civend.1003
	title = civend.1003.name
	desc = civend.1003.desc
	picture = GFX_evt_ship_travel
	location = event_target:civwar_rebels
	hide_window = no
	is_triggered_only = yes
	
	# Damn it!
	option = {
		name = civend.1003.a
		hidden_effect = {
			country_event = { id = civend.5000 }
		}
	}
}

# Traitorous Leader Captured
country_event = {
	id = civend.1004
	title = civend.1004.name
	picture = GFX_evt_surrender
	location = event_target:civwar_rebels
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.1004.coup.desc
		trigger = {
			has_country_flag = captured_by_coup
		}
	}

	desc = {
		text = civend.1004.normal.desc
		trigger = {
			has_country_flag = captured_normally
		}
	}

	# Excellent
	option = {
		name = civend.1004.a
		hidden_effect = {
			country_event = { id = civcom.7000 }
		}
	}

	after = {
		if = {
			limit = {
				has_country_flag = captured_by_coup
			}
			remove_country_flag = captured_by_coup
		}
		else_if = {
			limit = {
				has_country_flag = captured_normally
			}
			remove_country_flag = captured_normally
		}
	}
}

# Initializer, subject Civil Wars
country_event = {
	id = civend.2000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			using_war_goal = {
				type = wg_civwar_subject
				owner = root
			}
			any_war_participant = {
				has_country_flag = subject_for_traitor
			}
		}
	}

	immediate = {

		fromfrom = {
			random_attacker = {
				limit = {
					has_country_flag = subject_for_traitor
				}
				remove_country_flag = subject_for_traitor
				save_event_target_as = traitor_subject_country
			}
		}

		from = {
			ruler = {
				save_global_event_target_as = defeated_traitor
			}
		}

		if = {
			limit = {
				is_autocracy = yes
			}
			random_list = {
				40 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						30 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						5 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					event_target:traitor_subject_country = {
						country_event = { id = civend.1001 }
					}
				}
				45 = {
					random_list = {
						30 = { # Disappears
							event_target:traitor_subject_country = {
								country_event = { id = civend.1002 }
							}
						}
						70 = { # Works for foreign empire
							event_target:traitor_subject_country = {
								country_event = { id = civend.1003 }
							}
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					event_target:traitor_subject_country = {
						country_event = { id = civend.1004 }
					}
				}
			}
		}
		else = {
			random_list = {
				30 = { # Death
					random_list = {
						25 = { # Suicide
							set_country_flag = death_by_hanging
						}
						15 = { # Suicide
							set_country_flag = death_by_jumping
						}
						15 = { # Suicide
							set_country_flag = death_by_spacing
						}
						25 = { # Suicide
							set_country_flag = death_by_gun
						}
						10 = { # Suicide
							set_country_flag = death_by_poison
						}
						10 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = death_by_coup
						}
					}
					event_target:traitor_subject_country = {
						country_event = { id = civend.1001 }
					}
				}
				55 = {
					random_list = {
						50 = { # Disappears
							event_target:traitor_subject_country = {
								country_event = { id = civend.1002 }
							}
						}
						50 = { # Works for foreign empire
							event_target:traitor_subject_country = {
								country_event = { id = civend.1003 }
							}
						}
					}
				}
				15 = { # Captured
					random_list = {
						15 = { # Those around them saw the end, killed the leader to gain lesser punishment
							set_country_flag = captured_by_coup
						}
						85 = { # Captured by special forces
							set_country_flag = captured_normally
						}
					}
					event_target:traitor_subject_country = {
						country_event = { id = civend.1004 }
					}
				}
			}
		}
	}
}

########

# Traitorous Leader is attempting to escape to another empire, will work for them.
country_event = {
	id = civend.5000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:defeated_traitor
	}
	
	immediate = {

		if = {
			limit = {
				is_overlord = yes
			}
			every_subject = {
				set_country_flag = is_a_subject
			}
		}

		if = {
			limit = {
				any_country = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
						has_country_flag = is_a_subject
					}
				}
			}
			save_event_target_as = traitor_home_country
			random_country = {
				limit = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
						has_country_flag = is_a_subject
					}
				}
				country_event = { id = civend.5001 }
			}
		}
	}

	after = {
		if = {
			limit = {
				is_overlord = yes
			}
			every_subject = {
				remove_country_flag = is_a_subject
			}
		}
	}
}

# Traitorous Leader is attempting to escape to another empire, country notification.
country_event = {
	id = civend.5001
	title = civend.5001.name
	desc = civend.5001.desc
	picture = GFX_evt_ship_travel
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	option = {
		name = civend.5001.a
		hidden_effect = {
			country_event = { id = civcom.8000 }
		}
	}
}

# Traitorous Leader escaped to another empire, notify mother country.
country_event = {
	id = civend.5002
	title = civend.5002.name
	desc = civend.5002.desc
	picture = GFX_evt_ship_travel
	location = from.capital_scope
	hide_window = no
	is_triggered_only = yes

	option = { # How dare they accept them!
		name = civend.5002.a
		hidden_effect = {
			add_opinion_modifier = {
				who = from
				modifier = opinion_received_traitor
			}
		}
	}
}

# Traitorous Leader escaped to another empire, notify mother country, Admiral localisation
country_event = {
	id = civend.5012
	title = civend.5002.name
	desc = civend.5012.desc
	picture = GFX_evt_ship_travel
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	option = { # How dare they accept them!
		name = civend.5002.a
		hidden_effect = {
			add_opinion_modifier = {
				who = from
				modifier = opinion_received_traitor
			}
		}
	}
}

########

# Banished Leader is attempting to gain employ in another empire.
country_event = {
	id = civend.5100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:defeated_traitor
	}
	
	immediate = {

		if = {
			limit = {
				is_overlord = yes
			}
			every_subject = {
				set_country_flag = is_a_subject
			}
		}

		if = {
			limit = {
				any_country = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
						has_country_flag = is_a_subject
					}
				}
			}
			save_event_target_as = traitor_home_country
			random_country = {
				limit = {
					is_country_type_with_subjects = yes
					has_communications = root
					NOR = {
						is_loyal_to = root
						is_overlord_to = root
						is_custodial_to = root
						is_genocidal = yes
						has_country_flag = traitor_already_asked
						has_country_flag = is_a_subject
					}
				}
				country_event = { id = civend.5101 }
			}
		}
	}

	after = {
		if = {
			limit = {
				is_overlord = yes
			}
			every_subject = {
				remove_country_flag = is_a_subject
			}
		}
	}
}

###########################
### Civil War Epilogues ###
###########################

# Traitorous Leader Installed at end of war.
country_event = {
	id = civend.5004
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_war_flag = war_traitor_1_@root
				has_war_flag = war_traitor_2_@root
				has_war_flag = war_traitor_3_@root
				has_war_flag = war_traitor_4_@root
				has_war_flag = war_traitor_5_@root
			}
		}
	}

	immediate = {

		if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_1_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = traitor_1_@root
				}
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = traitor_country_1_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = traitor_country_mother_1_@root
				set_installed_traitor_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_2_@root
				}
			}
			remove_country_flag = traitor_country_2_@root
			random_owned_leader = {
				limit = {
					has_leader_flag = traitor_2_@root
				}
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = traitor_country_mother_2_@root
				set_installed_traitor_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_3_@root
				}
			}
			remove_country_flag = traitor_country_3_@root
			random_owned_leader = {
				limit = {
					has_leader_flag = traitor_3_@root
				}
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = traitor_country_mother_3_@root
				set_installed_traitor_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_4_@root
				}
			}
			remove_country_flag = traitor_country_4_@root
			random_owned_leader = {
				limit = {
					has_leader_flag = traitor_4_@root
				}
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = traitor_country_mother_4_@root
				set_installed_traitor_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_5_@root
				}
			}
			remove_country_flag = traitor_country_5_@root
			random_owned_leader = {
				limit = {
					has_leader_flag = traitor_5_@root
				}
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = traitor_country_mother_5_@root
				set_installed_traitor_gov = yes
			}
		}
	}

	after = {
		clear_global_event_target = traitor_leader
	}
}

# Traitorous Leader Retrieved at end of war.
country_event = {
	id = civend.5005
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_war_flag = war_traitor_retrieve_1_@root
				has_war_flag = war_traitor_retrieve_2_@root
				has_war_flag = war_traitor_retrieve_3_@root
				has_war_flag = war_traitor_retrieve_4_@root
				has_war_flag = war_traitor_retrieve_5_@root
			}
		}
	}

	immediate = {
		if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_retrieve_1_@root
				}
			}
			remove_country_flag = traitor_country_mother_1_@root
			from = {
				remove_country_flag = traitor_country_1_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = traitor_1_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_retrieve_2_@root
				}
			}
			remove_country_flag = traitor_country_mother_2_@root
			from = {
				remove_country_flag = traitor_country_2_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = traitor_2_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_retrieve_3_@root
				}
			}
			remove_country_flag = traitor_country_mother_3_@root
			from = {
				remove_country_flag = traitor_country_3_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = traitor_3_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_retrieve_4_@root
				}
			}
			remove_country_flag = traitor_country_mother_4_@root
			from = {
				remove_country_flag = traitor_country_4_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = traitor_4_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_traitor_retrieve_5_@root
				}
			}
			remove_country_flag = traitor_country_mother_5_@root
			from = {
				remove_country_flag = traitor_country_5_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = traitor_5_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		country_event = { id = civcom.7600 }
	}
}

# Traitorous Leader Executed.
country_event = {
	id = civend.5006
	title = civend.5006.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5006.hanged.desc
		trigger = {
			has_country_flag = traitor_hanged
		}
	}

	desc = {
		text = civend.5006.firing_squad.desc
		trigger = {
			has_country_flag = traitor_firing_squad
		}
	}

	desc = {
		text = civend.5006.guillotine.desc
		trigger = {
			has_country_flag = traitor_guillotine
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			clear_global_event_target = defeated_traitor
			if = {
				limit = {
					has_country_flag = traitor_hanged
				}
				remove_country_flag = traitor_hanged
			}
			else_if = {
				limit = {
					has_country_flag = traitor_firing_squad
				}
				remove_country_flag = traitor_firing_squad
			}
			else_if = {
				limit = {
					has_country_flag = traitor_guillotine
				}
				remove_country_flag = traitor_guillotine
			}
		}
	}
}

# Retrieved Traitorous Leader Executed.
country_event = {
	id = civend.5007
	title = civend.5007.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5007.hanged.desc
		trigger = {
			has_country_flag = traitor_hanged
		}
	}

	desc = {
		text = civend.5007.firing_squad.desc
		trigger = {
			has_country_flag = traitor_firing_squad
		}
	}

	desc = {
		text = civend.5007.guillotine.desc
		trigger = {
			has_country_flag = traitor_guillotine
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			event_target:retrieved_traitor = { 	kill_leader = { show_notification = no } }
			clear_global_event_target = retrieved_traitor
			if = {
				limit = {
					has_country_flag = traitor_hanged
				}
				remove_country_flag = traitor_hanged
			}
			else_if = {
				limit = {
					has_country_flag = traitor_firing_squad
				}
				remove_country_flag = traitor_firing_squad
			}
			else_if = {
				limit = {
					has_country_flag = traitor_guillotine
				}
				remove_country_flag = traitor_guillotine
			}
		}
	}
}

# Traitorous Leader Tortured and died.
country_event = {
	id = civend.5008
	title = civend.5008.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5008.flayed.desc
		trigger = {
			has_country_flag = traitor_flayed
		}
	}

	desc = {
		text = civend.5008.stretched.desc
		trigger = {
			has_country_flag = traitor_stretched
		}
	}

	desc = {
		text = civend.5008.piked.desc
		trigger = {
			has_country_flag = traitor_piked
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			if = {
				limit = { exists = event_target:defeated_traitor }
				event_target:defeated_traitor = { kill_leader = { show_notification = no } }
			}
			clear_global_event_target = defeated_traitor
			if = {
				limit = {
					has_country_flag = traitor_flayed
				}
				remove_country_flag = traitor_flayed
			}
			else_if = {
				limit = {
					has_country_flag = traitor_stretched
				}
				remove_country_flag = traitor_stretched
			}
			else_if = {
				limit = {
					has_country_flag = traitor_piked
				}
				remove_country_flag = traitor_piked
			}
		}
	}
}

# Retrieved Traitorous Leader Tortured and died.
country_event = {
	id = civend.5009
	title = civend.5008.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5009.flayed.desc
		trigger = {
			has_country_flag = traitor_flayed
		}
	}

	desc = {
		text = civend.5009.stretched.desc
		trigger = {
			has_country_flag = traitor_stretched
		}
	}

	desc = {
		text = civend.5009.piked.desc
		trigger = {
			has_country_flag = traitor_piked
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			event_target:retrieved_traitor = { kill_leader = { show_notification = no } }
			if = {
				limit = {
					has_country_flag = traitor_flayed
				}
				remove_country_flag = traitor_flayed
			}
			else_if = {
				limit = {
					has_country_flag = traitor_stretched
				}
				remove_country_flag = traitor_stretched
			}
			else_if = {
				limit = {
					has_country_flag = traitor_piked
				}
				remove_country_flag = traitor_piked
			}
		}
	}
}

#####

# Traitorous Heir Installed at end of war.
country_event = {
	id = civend.6000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_war_flag = war_heir_traitor_1_@root
				has_war_flag = war_heir_traitor_2_@root
				has_war_flag = war_heir_traitor_3_@root
				has_war_flag = war_heir_traitor_4_@root
				has_war_flag = war_heir_traitor_5_@root
			}
		}
	}

	immediate = {
		if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_1_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = heir_traitor_1_@root
				}
				remove_leader_flag = heir_traitor_1_@root
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = heir_traitor_country_1_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = heir_traitor_country_mother_1_@root
				set_installed_heir_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_2_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = heir_traitor_2_@root
				}
				remove_leader_flag = heir_traitor_2_@root
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = heir_traitor_country_2_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = heir_traitor_country_mother_2_@root
				set_installed_heir_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_3_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = heir_traitor_3_@root
				}
				remove_leader_flag = heir_traitor_3_@root
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = heir_traitor_country_3_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = heir_traitor_country_mother_3_@root
				set_installed_heir_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_4_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = heir_traitor_4_@root
				}
				remove_leader_flag = heir_traitor_4_@root
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = heir_traitor_country_4_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = heir_traitor_country_mother_4_@root
				set_installed_heir_gov = yes
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_5_@root
				}
			}
			random_owned_leader = {
				limit = {
					has_leader_flag = heir_traitor_5_@root
				}
				remove_leader_flag = heir_traitor_5_@root
				save_global_event_target_as = traitor_leader
				exile_leader_as = traitor_leader
			}
			remove_country_flag = heir_traitor_country_5_@root
			set_country_flag = installer_country_@event_target:traitor_leader
			from = {
				remove_country_flag = heir_traitor_country_mother_5_@root
				set_installed_heir_gov = yes
			}
		}
	}

	after = {
		clear_global_event_target = traitor_leader
	}
}

# Traitorous Heir Retrieved at end of war.
country_event = {
	id = civend.6001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_war_flag = war_heir_traitor_retrieve_1_@root
				has_war_flag = war_heir_traitor_retrieve_2_@root
				has_war_flag = war_heir_traitor_retrieve_3_@root
				has_war_flag = war_heir_traitor_retrieve_4_@root
				has_war_flag = war_heir_traitor_retrieve_5_@root
			}
		}
	}

	immediate = {
		if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_retrieve_1_@root
				}
			}
			remove_country_flag = heir_traitor_country_mother_1_@root
			from = {
				remove_country_flag = heir_traitor_country_1_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = heir_traitor_1_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_retrieve_2_@root
				}
			}
			remove_country_flag = war_heir_traitor_mother_2_@root
			from = {
				remove_country_flag = heir_traitor_country_2_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = heir_traitor_2_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_retrieve_3_@root
				}
			}
			remove_country_flag = war_heir_traitor_mother_3_@root
			from = {
				remove_country_flag = heir_traitor_country_3_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = heir_traitor_3_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_retrieve_4_@root
				}
			}
			remove_country_flag = war_heir_traitor_mother_4_@root
			from = {
				remove_country_flag = heir_traitor_country_4_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = heir_traitor_4_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		else_if = {
			limit = {
				fromfrom = {
					has_war_flag = war_heir_traitor_retrieve_5_@root
				}
			}
			remove_country_flag = war_heir_traitor_mother_5_@root
			from = {
				remove_country_flag = heir_traitor_country_5_@root
				random_owned_leader = {
					limit = {
						has_leader_flag = heir_traitor_5_@prev
					}
					save_global_event_target_as = retrieved_traitor
					exile_leader_as = retrieved_traitor
				}
			}
		}
		country_event = { id = civcom.7600 }
	}
}

# Traitorous Heir Executed.
country_event = {
	id = civend.6002
	title = civend.5006.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5006.hanged.desc
		trigger = {
			has_country_flag = traitor_hanged
		}
	}

	desc = {
		text = civend.5006.firing_squad.desc
		trigger = {
			has_country_flag = traitor_firing_squad
		}
	}

	desc = {
		text = civend.5006.guillotine.desc
		trigger = {
			has_country_flag = traitor_guillotine
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			clear_global_event_target = defeated_traitor
			if = {
				limit = {
					has_country_flag = traitor_hanged
				}
				remove_country_flag = traitor_hanged
			}
			else_if = {
				limit = {
					has_country_flag = traitor_firing_squad
				}
				remove_country_flag = traitor_firing_squad
			}
			else_if = {
				limit = {
					has_country_flag = traitor_guillotine
				}
				remove_country_flag = traitor_guillotine
			}
		}
	}
}

# Traitorous Heir Tortured and died.
country_event = {
	id = civend.6003
	title = civend.5008.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5009.flayed.desc
		trigger = {
			has_country_flag = traitor_flayed
		}
	}

	desc = {
		text = civend.5009.stretched.desc
		trigger = {
			has_country_flag = traitor_stretched
		}
	}

	desc = {
		text = civend.5009.piked.desc
		trigger = {
			has_country_flag = traitor_piked
		}
	}

	option = { # Good
		name = civend.5006.a
		hidden_effect = {
			clear_global_event_target = defeated_traitor
			if = {
				limit = {
					has_country_flag = traitor_flayed
				}
				remove_country_flag = traitor_flayed
			}
			else_if = {
				limit = {
					has_country_flag = traitor_stretched
				}
				remove_country_flag = traitor_stretched
			}
			else_if = {
				limit = {
					has_country_flag = traitor_piked
				}
				remove_country_flag = traitor_piked
			}
		}
	}
}

# Retrieved Traitorous Heir Executed.
country_event = {
	id = civend.6004
	title = civend.5007.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

	desc = {
		text = civend.5007.hanged.desc
		trigger = {
			has_country_flag = traitor_hanged
		}
	}

	desc = {
		text = civend.5007.firing_squad.desc
		trigger = {
			has_country_flag = traitor_firing_squad
		}
	}

	desc = {
		text = civend.5007.guillotine.desc
		trigger = {
			has_country_flag = traitor_guillotine
		}
	}

	option = { # Good
		name = civend.5006.a
		if = {
				limit = {
					has_country_flag = traitor_hanged
				}
				remove_country_flag = traitor_hanged
			}
			else_if = {
				limit = {
					has_country_flag = traitor_firing_squad
				}
				remove_country_flag = traitor_firing_squad
			}
			else_if = {
				limit = {
					has_country_flag = traitor_guillotine
				}
				remove_country_flag = traitor_guillotine
			}
	}
}

# Retrieved Traitorous Heir Tortured and died.
country_event = {
	id = civend.6005
	title = civend.6005.name
	picture = GFX_evt_announcement
	location = root.capital_scope
	hide_window = no
	is_triggered_only = yes

		desc = {
		text = civend.5009.flayed.desc
		trigger = {
			has_country_flag = traitor_flayed
		}
	}

	desc = {
		text = civend.5009.stretched.desc
		trigger = {
			has_country_flag = traitor_stretched
		}
	}

	desc = {
		text = civend.5009.piked.desc
		trigger = {
			has_country_flag = traitor_piked
		}
	}

	option = { # Good
		name = civend.5006.a
		event_target:retrieved_traitor = { kill_leader = { show_notification = no } }
		clear_global_event_target = retrieved_traitor
		if = {
			limit = {
				has_country_flag = traitor_flayed
			}
			remove_country_flag = traitor_flayed
		}
		else_if = {
			limit = {
				has_country_flag = traitor_stretched
			}
			remove_country_flag = traitor_stretched
		}
		else_if = {
			limit = {
				has_country_flag = traitor_piked
			}
			remove_country_flag = traitor_piked
		}
	}
}

######

# Dead Installed Leader, remove grateful modifier
country_event = {
	id = civend.9000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			leader_class = ruler
			has_leader_flag = grateful_restored_leader_@this
		}
	}

	immediate = {

		from = {
			save_global_event_target_as = dead_grateful_leader
		}

		random_country = {
			limit = {
				has_country_flag = installer_country_@event_target:dead_grateful_leader
			}
			remove_country_flag = installer_country_@event_target:dead_grateful_leader
			save_event_target_as = remove_grateful_modifier_country
		}

		clear_global_event_target = dead_grateful_leader

		remove_opinion_modifier = {
			who = event_target:remove_grateful_modifier_country
			modifier = opinion_restored_to_leadership
		}
	}
}

# Dead fleeing traitor
country_event = {
	id = civend.9001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			OR = {
				has_leader_flag = traitor_1_@root
				has_leader_flag = traitor_2_@root
				has_leader_flag = traitor_3_@root
				has_leader_flag = traitor_4_@root
				has_leader_flag = traitor_5_@root
			}
		}
	}

	immediate = {

		from = { save_event_target_as = dead_traitor }

		if = {
			limit = {
				has_country_flag = traitor_country_1_@root
			}
			remove_country_flag = traitor_country_1_@root
			random_country = {
				limit = {
					has_country_flag = traitor_country_mother_1_@root
				}
				remove_country_flag = traitor_country_mother_1_@root
				country_event = { id = civend.9005 }
			}
		}
		else_if = {
			limit = {
				has_country_flag = traitor_country_2_@root
			}
			remove_country_flag = traitor_country_2_@root
			random_country = {
				limit = {
					has_country_flag = traitor_country_mother_2_@root
				}
				remove_country_flag = traitor_country_mother_2_@root
				country_event = { id = civend.9005 }
			}
		}
		else_if = {
			limit = {
				has_country_flag = traitor_country_3_@root
			}
			remove_country_flag = traitor_country_3_@root
			random_country = {
				limit = {
					has_country_flag = traitor_country_mother_3_@root
				}
				remove_country_flag = traitor_country_mother_3_@root
				country_event = { id = civend.9005 }
			}
		}
		else_if = {
			limit = {
				has_country_flag = traitor_country_4_@root
			}
			remove_country_flag = traitor_country_4_@root
			random_country = {
				limit = {
					has_country_flag = traitor_country_mother_4_@root
				}
				remove_country_flag = traitor_country_mother_4_@root
				country_event = { id = civend.9005 }
			}
		}
		else_if = {
			limit = {
				has_country_flag = traitor_country_5_@root
			}
			remove_country_flag = traitor_country_5_@root
			random_country = {
				limit = {
					has_country_flag = traitor_country_mother_5_@root
				}
				remove_country_flag = traitor_country_mother_5_@root
				country_event = { id = civend.9005 }
			}
		}
	}
}

# Treasonous Leader has died notification
country_event = {
	id = civend.9005
	title = civend.9005.name
	desc = civend.9005.desc
	picture = GFX_evt_spy_network
	hide_window = no
	is_triggered_only = yes

	option = { # One less threat to stability.
		name = civheir.8100.a
	}
}
